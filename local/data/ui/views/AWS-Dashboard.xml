<?xml version='1.0' encoding='utf-8'?>
<dashboard>
  <label>AWS Dashboard</label>

  <row>
                <chart>
      <searchString>index=aws-data  sourcetype=aws-data running="Y" reserved="N"| timechart distinct_count(instanceid) by instancetype useother=f</searchString>
      <title>On Demand Running Instances by Instancetype</title>
      <earliestTime>-7d@h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.chart">column</option>
      <option name="charting.chart.nullValueMode">gaps</option>
      <option name="charting.chart.stackMode">stacked</option>
      <option name="charting.layout.splitSeries">false</option>
      <option name="charting.legend.placement">right</option>
      <option name="charting.secondaryAxis.maximumNumber">""</option>
      <option name="charting.secondaryAxis.minimumNumber">""</option>
      <option name="count">50</option>
      <option name="displayRowNumbers">true</option>
      <option name="drilldown">all</option>
    </chart>
  </row>
  <row>
    
           <chart>
      <searchString>index=aws-data sourcetype=aws-data source=aws-rds AND rds_id!=NULL | timechart distinct_count(rds_id) by rds_db_instance_type</searchString>
      <title>RDS Running Instances by Instancetype</title>
      <earliestTime>-7d@h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.chart">column</option>
      <option name="charting.chart.nullValueMode">gaps</option>
      <option name="charting.chart.stackMode">stacked</option>
      <option name="charting.layout.splitSeries">false</option>
      <option name="charting.legend.placement">right</option>
      <option name="charting.secondaryAxis.maximumNumber">""</option>
      <option name="charting.secondaryAxis.minimumNumber">""</option>
      <option name="count">50</option>
      <option name="displayRowNumbers">true</option>
      <option name="drilldown">all</option>
    </chart>     
      
      

  </row>
  <row>
    <chart>
      <searchString>index=aws-data  sourcetype=aws-data earliest=-65m | dedup instanceid | chart count(eval(reserved="N" AND running="Y")) as on-demand-Is</searchString>
      <title>On-Demand Instances Total - (last hour)</title>
      <option name="charting.chart">radialGauge</option>
      <option name="charting.chart.rangeValues">[0,100,300,1000]</option>
      <option name="charting.gaugeColors">[0x84e900,0xffe800,0xbf3030]</option>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>index=aws-data  sourcetype=aws-data earliest=-65m |dedup instanceid | chart count(eval(running="Y")) as RIs</searchString>
      <title>Running Instances - All</title>
      <option name="charting.chart">radialGauge</option>
      <option name="charting.chart.rangeValues">[500,1000,1500]</option>
      <option name="charting.gaugeColors">[0x84e900,0xffe800,0xbf3030]</option>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>index=aws-data  sourcetype=aws-data earliest=-65m | dedup instanceid | chart count(eval(reserved="Y" AND running="N")) as Un-used-RIs</searchString>
      <title>Un-Used RIs Total - (last hour)</title>
      <option name="charting.chart">radialGauge</option>
      <option name="charting.chart.rangeValues">[0,100,200,400]</option>
      <option name="charting.gaugeColors">[0x84e900,0xffe800,0xbf3030]</option>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
  </row>
  <row>
    <chart>
      <searchString>index=aws-data sourcetype=aws-data | stats distinct_count(instanceid) by SERVICE_NAME</searchString>
      <title>Running instances by Service Name </title>
      <option name="charting.chart">pie</option>
      <option name="count">50</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>index=aws-data sourcetype=aws-data | stats distinct_count(instanceid) by SUPPORT_T3</searchString>
      <title>Running instances by Support (T3) </title>
      <option name="charting.chart">pie</option>
      <option name="count">50</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <chart>
      <searchString>index=aws-data  sourcetype=aws-data | dedup instanceid | timechart span=1h  count(eval(running="Y")) as RIs by subaccount useother=f usenull=f</searchString>
      <title>Running Instances - All</title>
      <earliestTime>-10d</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.chart">area</option>
      <option name="charting.chart.stackMode">stacked</option>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
  </row>
  <row>
    <chart>
      <searchString>index=aws-data sourcetype=aws-data | stats distinct_count(instanceid) by OWNER_T3</searchString>
      <title>Running instances by Owner (T3) </title>
      <option name="charting.chart">pie</option>
      <option name="count">50</option>
      <option name="displayRowNumbers">true</option>
    </chart>
<table>
      <searchString>index=aws-data sourcetype=aws-data earliest=-3mon| dedup instanceid | bucket _time span=1h | stats count(eval(running="Y")) as running by instancetype,_time| stats min(running) as baseline1, stdev(running) as baseline2, mode(running) as baseline3 by instancetype |eval baseline-low=baseline1 | eval baseline-stdev=round(baseline2) | eval baseline-mod=round(baseline3)| fields instancetype,baseline-low,baseline-mod,baseline-stdev</searchString>
      <title>Baseline Estimation - based on last 3 months of usage</title>
    </table>
    <chart>
      <searchString>index=aws-data sourcetype=aws-data | stats distinct_count(instanceid) by SERVICE_ENVIRONMENT</searchString>
      <title>Running instances by Service Environment </title>
      <option name="charting.chart">pie</option>
      <option name="count">50</option>
      <option name="displayRowNumbers">true</option>
      <option name="drilldown">all</option>
    </chart>
  </row>
      <row>
    <chart>
      <searchString>index=aws-data sourcetype=aws-data  subaccount!="1" subaccount!="$11" | stats first(amount) as amt</searchString>
      <title>AWS Bill - Till Today</title>
      <earliestTime>-24h</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.chart">radialGauge</option>
      <option name="charting.chart.rangeValues">[0,50000,100000,150000]</option>
      <option name="charting.gaugeColors">[0x84e900,0xffe800,0xbf3030]</option>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
    <table>
      <searchString>index=aws-data sourcetype=aws-data earliest=-24h  subaccount!="1" subaccount!="$11" | stats values(amount) as amt by subaccount| sort -amt</searchString>
      <title>AWS Monthly Bill - Till Today</title>
      <option name="count">5</option>
      <option name="displayRowNumbers">true</option>
    </table>
    <chart>
      <searchString>index=aws-data source=aws-bill  earliest=-24h subaccount!="1" subaccount!="$11" |stats sum(amount) as amt, avg(date_wday) as dayno| eval projected=round(30*amt/dayno) |fields projected</searchString>
      <title>Monthly Billing Projection</title>
      <earliestTime>-24h</earliestTime>
      <option name="charting.chart">radialGauge</option>
      <option name="charting.chart.rangeValues">[0,50000,100000,150000]</option>
      <option name="charting.gaugeColors">[0x84e900,0xffe800,0xbf3030]</option>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
  </row>
  <row>
    <chart>
      <searchString>index=aws-data sourcetype=aws-data  earliest=@mon latest=now | stats sum(amount) as This_Month by _time | appendcols [ search index=aws-data sourcetype=aws-data  earliest=-mon@mon latest=-mon| stats sum(amount) as Last_Month by _time ]  | fields _time, This_Month, Last_Month </searchString>
      <title> Month over Month Comparison </title>
      <option name="charting.axisY.scale">linear</option>
      <option name="charting.chart">column</option>
      <option name="charting.chart.nullValueMode">connect</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.legend.placement">bottom</option>
      <option name="charting.secondaryAxis.scale">linear</option>
      <option name="count">10</option>
      <option name="displayRowNumbers">true</option>
    </chart>
  </row>
</dashboard>